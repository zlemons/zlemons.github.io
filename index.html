<html>  
    <head>
        <title>
            N328 Final Project
        </title>
        <script src="https://unpkg.com/d3@7.4.4/dist/d3.js"></script>
        <style>
            #tooltip {
                position: absolute;
                width: 75px;
                height: 100px;
                padding: 5px;
                background-color: white;
                -webkit-border-radius: 10px;
                -moz-border-radius: 10px;
                border-radius: 10px;
                -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
                -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
                box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
                pointer-events: none;}
            #tooltip.hidden {
                    display: none;}
            #tooltip p {
                margin: 0;
                font-family: sans-serif;
                font-size: 12px;
                line-height: 20px;}
           

        </style>
    </head>
    <body>
        <h2>Sloth Weight VS Tail Length</h2>
        <div id="tooltip" class="hidden">
            <p><strong>Sloth Data:</strong></p>
            <p>Weight:</p>
            <p><span id="weight">weight</span></p>
            <p>Tail Length:</p>
            <p><span id="tail">tail</span></p>
           </div>
        <script>
                var hoveredValue = null;
                var filteredData;
                var margin = {top: 10, right: 70, bottom: 40, left: 50},
                    width = 500 - margin.left - margin.right,
                    height = 400 - margin.top - margin.bottom;

                var Svg = d3.select("body")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform","translate(" + margin.left + "," + margin.top + ")")


            d3.csv("sloth_data.csv").then((data) => {
                data.forEach((d) => {
                    d.claw_length_cm = +d.claw_length_cm;
                    d.size_cm = + d.size_cm;
                    d.tail_length_cm = + d.tail_length_cm;
                    d.weight_kg = + d.weight_kg;
            });
            // Place Function Calls Here ---------------------------------------------------------------
            generateGraph(data);
            var filteredData = data;
            });

            // Functions
            var formatData = function(data){
                var formattedData = data;
                return formattedData;
            }
            var selectState = function (data) {
                console.log(hoveredValue);
                var filteredData = data.filter(f => hoveredValue === f.specie);
                console.log(filteredData)
            
            };
            var generateGraph = function(data){
                console.log(hoveredValue)
                // X-axis Configuration -------------------------------------------------------------------------------------------------------
                var x = d3.scaleLinear()
                    .domain([0 , (d3.max(data, function(d){return d.weight_kg}))+1])
                    .range([ 0, width])
                Svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x).tickSize(-height*1.2).ticks(10))
                    .select(".domain").remove()
                // Y-axis Configuration -------------------------------------------------------------------------------------------------------
                var y = d3.scaleLinear()
                    .domain([-4, (d3.max(data, function(d){return d.tail_length_cm}))+1])
                    .range([ height, 0])
                    .nice()
                Svg.append("g")
                    .call(d3.axisLeft(y).tickSize(-width*1.3).ticks(7))
                    .select(".domain").remove()
                    Svg.selectAll(".tick line").attr("stroke", "#EBEBEB")
                // X-axis Label ---------------------------------------------------------------------------------------------------------------
                Svg.append("text")
                    .attr("text-anchor", "end")
                    .attr("x", width / 2 + margin.left)
                    .attr("y", height + margin.top + 25)
                    .text("Weight (kg)");

                // Y-axis Label ---------------------------------------------------------------------------------------------------------------
                Svg.append("text")
                    .attr("text-anchor", "end")
                    .attr("transform", "rotate(-90)")
                    .attr("y", -margin.left+20)
                    .attr("x", -margin.top - 100)
                    .text("Tail Length (cm)")
                
                // set the color scale
                var colorScale = d3.scaleOrdinal()
                    .domain(["two_toed", "three_toed"])
                    .range([ "#FF7F50", "#19ADF8"])

                
                // Plot the points on the graph
                Svg.append('g')
                    .selectAll("dot")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("class", function(d){return d.specie;})
                    .attr("cx", function (d) { return x(d.weight_kg); } )
                    .attr("cy", function (d) { return y(d.tail_length_cm); } )
                    .attr("r", 1.5)
                    .style("fill", function (d) { return colorScale(d.specie) } )
                    .on("mouseover", function(d,i){
                        var xPosition = parseFloat(d3.select(this).attr("cx")) + 20;
                        var yPosition = parseFloat(d3.select(this).attr("cy")) + 14;
                        d3.select("#tooltip")
                            .style("left", xPosition + "px")
                            .style("top", yPosition + "px")
                            .select("#weight")
                            .text(i.weight_kg)
                        d3.select("#tooltip")
                            .select("#tail")
                            .text(i.tail_length_cm)
                        d3.select("#tooltip").classed("hidden", false);
                            })

                    .on("mouseout", function() {d3.select("#tooltip").classed("hidden", true)
;})
                    Svg.selectAll("legendCircles")
                    .data(colorScale.domain())
                    .enter()
                    .append("circle")
                        .attr("cx", 370)
                        .attr("cy", function(d,i){ return 100 + i*25})
                        .attr("r", 7)
                        .attr("class", function(d){return d;})
                        .style("fill", function(d){ return colorScale(d)})
                    .on("click", function(d,i){
                        var currentOpacity = d3.selectAll("." + i).style("opacity")
                        console.log(currentOpacity)
                        d3.selectAll("." + i).transition().style("opacity", currentOpacity == 1 ? 0.2:1)
                    })

                    Svg.selectAll("legendLabels")
                         .data(colorScale.domain())
                        .enter()
                        .append("text")
                            .attr("x", 380)
                            .attr("y", function(d,i){ return 100 + i*25})
                            .attr("class", function(d){return d;})
                            .style("fill", function(d){ return colorScale(d)})
                            .text(function(d){return d;})
                            .attr("text-anchor", "left")
                            .style("alignment-baseline", "middle")

                    Svg.append("text")
                        .attr("text-anchor", "end")
                        .attr("x", 440)
                        .attr("y", 80 )
                        .text("Sloth Type");
            }
        </script>
        <a href="https://docs.google.com/document/d/1pOD3YnbxuQ3dXKc5UJEwLkbl5v7ap40OwJ0sv3BMEiI/edit?usp=sharing" target="_blank">Final Documentation Page (CLICK HERE)!</a>
    </body>
</html>
